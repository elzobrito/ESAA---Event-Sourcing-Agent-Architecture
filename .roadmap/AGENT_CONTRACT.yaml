meta:
  contract_version: "0.4.0"
  esaa_version: "0.4.x"
  canonical: true
  fail_closed: true

vocabulary:
  allowed_agent_actions:
    - claim
    - complete
    - review
    - issue.report
  reserved_orchestrator_actions:
    - run.start
    - run.end
    - task.create
    - hotfix.create
    - issue.resolve
    - output.rejected
    - orchestrator.file.write
    - orchestrator.view.mutate
    - verify.start
    - verify.ok
    - verify.fail

output_contract:
  format:
    json_only: true
    forbid_markdown_outside_json: true
    forbid_extra_root_keys: true
  root_keys:
    required:
      - activity_event
    optional:
      - file_updates
  activity_event:
    required_fields:
      - action
      - task_id
    forbidden_fields:
      - schema_version
      - event_id
      - event_seq
      - ts
      - actor
      - payload
      - assigned_to
      - started_at
      - completed_at

boundaries:
  enforcement: "fail_closed"
  by_task_kind:
    spec:
      read:
        - ".roadmap/**"
        - "docs/**"
      write:
        - "docs/**"
      forbidden_write:
        - "src/**"
        - "tests/**"
        - ".roadmap/**"
    impl:
      read:
        - ".roadmap/**"
        - "docs/**"
        - "src/**"
        - "tests/**"
      write:
        - "src/**"
        - "tests/**"
      forbidden_write:
        - ".roadmap/**"
    qa:
      read:
        - ".roadmap/**"
        - "docs/**"
        - "src/**"
        - "tests/**"
      write:
        - "docs/qa/**"
        - "tests/**"
      forbidden_write:
        - "src/**"
  patch_scope:
    enabled: true
    scope_field_name: "scope_patch"
    allowlist_semantics: "prefix_match"
    require_scope_patch_for_hotfix_tasks: true

integrity_rules:
  immutable_done:
    enabled: true
    description: "done is terminal; fixes must use hotfix workflow"
  verification_gate:
    impl_min_checks: 1
    hotfix_min_checks: 2

hotfix_protocol:
  enabled: true
  flow:
    - issue.report
    - hotfix.create
    - complete
    - review
    - issue.resolve

