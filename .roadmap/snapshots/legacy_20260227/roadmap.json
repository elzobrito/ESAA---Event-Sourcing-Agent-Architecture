{
  "meta": {
    "schema_version": "1.0.0",
    "esaa_version": "2026.02.26",
    "immutable_todo": true,
    "master_correlation_id": "LLMGW-CORR-20260226-003",
    "baseline": {
      "baseline_id": "BL-LLMGW-V1-CORR",
      "name": "ESAA LLM Gateway Corporativo – Man-in-the-Middle com RAG Local, Modelo Fixo por API Key, Multi-Tenant, Painel de Administração e Deploy Dual",
      "created_at": "2026-02-01T09:00:00Z"
    },
    "run": {
      "last_event_seq": 312,
      "projection_hash_sha256": "a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2",
      "verify_status": "ok"
    },
    "updated_at": "2026-02-26T19:12:00Z"
  },
  "phases": [
    {
      "phase_id": "P01",
      "title": "01 - Discovery, Requisitos Funcionais Detalhados e System Design",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0101",
          "task_kind": "spec",
          "title": "RF-001..RF-004 | Consolidar requisitos gerais do gateway MITM com critérios de aceite, cenários de borda e métricas de sucesso",
          "status": "todo",
          "depends_on": [],
          "targets": ["RF-001", "RF-002", "RF-003", "RF-004"],
          "outputs": { "files": ["docs/requirements/01-gerais.md"] },
          "immutability": { "todo_is_immutable": true },
          "assigned_to": "Codex",
          "started_at": "2026-02-10T10:00:00Z",
          "completed_at": "2026-02-15T14:30:00Z"
        },
        {
          "task_id": "T0102",
          "task_kind": "spec",
          "title": "RF-010..RF-016 | Especificar contrato da API do Gateway (sync, stream, RAG e compatibilidade OpenAI) com exemplos e erros esperados",
          "status": "todo",
          "depends_on": ["T0101"],
          "targets": ["RF-010", "RF-011", "RF-012", "RF-013", "RF-014", "RF-015", "RF-016"],
          "outputs": { "files": ["docs/requirements/02-api.md"] },
          "immutability": { "todo_is_immutable": true },
          "assigned_to": "Codex",
          "started_at": "2026-02-15T15:00:00Z",
          "completed_at": "2026-02-18T12:00:00Z"
        },
        {
          "task_id": "T0103",
          "task_kind": "spec",
          "title": "RF-020..RF-026 | Especificar RAG Engine (indexação, chunking, embeddings, cache e recuperação) com limites e critérios de relevância",
          "status": "todo",
          "depends_on": ["T0102"],
          "targets": ["RF-020", "RF-021", "RF-022", "RF-023", "RF-024", "RF-025", "RF-026"],
          "outputs": { "files": ["docs/requirements/03-rag.md"] },
          "immutability": { "todo_is_immutable": true },
          "assigned_to": "Codex",
          "started_at": "2026-02-18T13:00:00Z",
          "completed_at": "2026-02-19T16:00:00Z"
        },
        {
          "task_id": "T0104",
          "task_kind": "spec",
          "title": "RF-030..RF-082 | Especificar roteamento multi-provider, segurança, painel admin, observabilidade e requisitos de deploy/operação",
          "status": "todo",
          "depends_on": ["T0103"],
          "targets": ["RF-030", "RF-031", "RF-032", "RF-033", "RF-040", "RF-041", "RF-042", "RF-050", "RF-051", "RF-052", "RF-053", "RF-054", "RF-055", "RF-056", "RF-060", "RF-061", "RF-062", "RF-070", "RF-071", "RF-072", "RF-073", "RF-074", "RF-075", "RF-076", "RF-080", "RF-081", "RF-082"],
          "outputs": { "files": ["docs/requirements/04-restantes.md"] },
          "immutability": { "todo_is_immutable": true },
          "assigned_to": "Codex",
          "started_at": "2026-02-19T17:00:00Z",
          "completed_at": "2026-02-21T11:00:00Z"
        },
        {
          "task_id": "T0105",
          "task_kind": "spec",
          "title": "RF-002,RF-013,RF-053 | Produzir arquitetura C4 e decisões do modelo fixo por API key com fluxos de autenticação e roteamento",
          "status": "todo",
          "depends_on": ["T0104"],
          "targets": ["RF-002", "RF-013", "RF-053"],
          "outputs": { "files": ["docs/system-design-c4.md"] },
          "immutability": { "todo_is_immutable": true },
          "assigned_to": "Codex",
          "started_at": "2026-02-21T12:00:00Z",
          "completed_at": "2026-02-22T15:00:00Z"
        }
      ]
    },
    {
      "phase_id": "P02",
      "title": "02 - Infraestrutura Base e Deploy Local Docker Compose",
      "status": "in_progress",
      "tasks": [
        {
          "task_id": "T0201",
          "task_kind": "impl",
          "title": "RF-070,RF-071 | Entregar docker-compose completo (Ollama, Postgres, LiteLLM, FastAPI e UI) com volumes persistentes e .env.example",
          "status": "todo",
          "depends_on": ["T0105"],
          "targets": ["RF-070", "RF-071"],
          "outputs": { "files": ["docker-compose.yml", ".env.example"] },
          "assigned_to": "Codex",
          "started_at": "2026-02-23T09:00:00Z",
          "completed_at": "2026-02-24T11:00:00Z"
        },
        {
          "task_id": "T0202",
          "task_kind": "impl",
          "title": "RF-070 | Entregar Dockerfile multi-stage da FastAPI (python:3.11-slim, non-root, cache controlado) com build reproduzível",
          "status": "todo",
          "depends_on": ["T0201"],
          "targets": ["RF-070"],
          "outputs": { "files": ["Dockerfile"] },
          "assigned_to": "Codex",
          "started_at": "2026-02-23T14:00:00Z",
          "completed_at": "2026-02-24T17:00:00Z"
        },
        {
          "task_id": "T0203",
          "task_kind": "qa",
          "title": "RF-070 | Executar smoke test automatizado do stack local (compose up, healthz, chat e ask) sem regressão de contrato",
          "status": "todo",
          "depends_on": ["T0202"],
          "targets": ["RF-070"],
          "outputs": { "files": ["tests/local-smoke.sh"] },
          "assigned_to": "Gemini-code",
          "started_at": "2026-02-25T10:00:00Z"
        }
      ]
    },
    {
      "phase_id": "P03",
      "title": "03 - FastAPI Facade e RAG Engine",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0301",
          "task_kind": "impl",
          "title": "RF-020..RF-026 | Implementar RAG Engine com fingerprint SHA256, cache embeddings/meta, ranking por cosseno e reindexação manual",
          "status": "todo",
          "depends_on": ["T0203"],
          "targets": ["RF-020", "RF-021", "RF-022", "RF-023", "RF-024", "RF-025", "RF-026"],
          "outputs": { "files": ["src/rag/"] },
          "assigned_to": "claude-opus"
        },
        {
          "task_id": "T0302",
          "task_kind": "impl",
          "title": "RF-010..RF-016 | Implementar /chat, /chat_stream, /ask, /v1/chat/completions e /healthz com validação de chave e modelo fixo",
          "status": "todo",
          "depends_on": ["T0301"],
          "targets": ["RF-010", "RF-011", "RF-012", "RF-013", "RF-014", "RF-015", "RF-016"],
          "outputs": { "files": ["src/api/"] },
          "assigned_to": "claude-opus"
        }
      ]
    },
    {
      "phase_id": "P04",
      "title": "04 - LiteLLM, Roteamento e Modelo Fixo por Key",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0401",
          "task_kind": "impl",
          "title": "RF-030..RF-033 | Configurar LiteLLM (model_list, providers e fallback hierárquico) com timeout por provedor e rastreio de uso",
          "status": "todo",
          "depends_on": ["T0201"],
          "targets": ["RF-030", "RF-031", "RF-032", "RF-033"],
          "outputs": { "files": ["litellm_config.yaml"] },
          "assigned_to": "Gemini-code"
        },
        {
          "task_id": "T0402",
          "task_kind": "impl",
          "title": "RF-013,RF-053 | Implementar middleware que resolve modelo fixo por API key e rejeita model divergente com erro 400 padronizado",
          "status": "todo",
          "depends_on": ["T0302", "T0401"],
          "targets": ["RF-013", "RF-053"],
          "outputs": { "files": ["src/middleware/"] },
          "assigned_to": "Gemini-code"
        }
      ]
    },
    {
      "phase_id": "P05",
      "title": "05 - Multi-Tenant, Painel Admin e Dashboard de Consumo",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0501",
          "task_kind": "impl",
          "title": "RF-050..RF-056 | Habilitar LiteLLM UI para multi-tenant (teams, virtual keys, modelo fixo obrigatório, dashboard e exportação)",
          "status": "todo",
          "depends_on": ["T0401", "T0402"],
          "targets": ["RF-050", "RF-051", "RF-052", "RF-053", "RF-054", "RF-055", "RF-056"],
          "outputs": { "files": ["docs/painel/"] },
          "assigned_to": "claude-opus"
        }
      ]
    },
    {
      "phase_id": "P06",
      "title": "06 - Autenticação, Rate Limiting, Budgets e Segurança",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0601",
          "task_kind": "impl",
          "title": "RF-040..RF-042 | Implementar validação de virtual key, rate limit por team/key e budgets com alertas e política de bloqueio",
          "status": "todo",
          "depends_on": ["T0302", "T0501"],
          "targets": ["RF-040", "RF-041", "RF-042"],
          "outputs": { "files": ["src/security/"] },
          "assigned_to": "claude-opus"
        }
      ]
    },
    {
      "phase_id": "P07",
      "title": "07 - CI/CD AKS, Persistência e Escala",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0701",
          "task_kind": "impl",
          "title": "RF-072..RF-076 | Implementar CI/CD AKS (pytest, buildx+ACR, helm upgrade, rollout status, probes e HPA com Azure Files)",
          "status": "todo",
          "depends_on": ["T0202"],
          "targets": ["RF-072", "RF-073", "RF-074", "RF-075", "RF-076"],
          "outputs": { "files": [".github/workflows/", "k8s/"] },
          "assigned_to": "claude-opus"
        }
      ]
    },
    {
      "phase_id": "P08",
      "title": "08 - Monitoramento, Logs, Configuração, Manutenibilidade e Go-Live",
      "status": "todo",
      "tasks": [
        {
          "task_id": "T0801",
          "task_kind": "impl",
          "title": "RF-060..RF-062,RF-080..RF-082 | Implementar logs JSON, métricas Prometheus, configuração env>yaml>default, DEV_MODE e migração automática",
          "status": "todo",
          "depends_on": ["T0601", "T0701"],
          "targets": ["RF-060", "RF-061", "RF-062", "RF-080", "RF-081", "RF-082"],
          "outputs": { "files": ["monitoring/", "docs/config.md"] },
          "assigned_to": "claude-opus"
        },
        {
          "task_id": "T0802",
          "task_kind": "qa",
          "title": "RF-040..RF-042 | Executar testes end-to-end (auth, rate, budgets, RAG e streaming) e concluir checklist de go-live com evidências",
          "status": "todo",
          "depends_on": ["T0801"],
          "targets": ["RF-040", "RF-041", "RF-042"],
          "assigned_to": "Codex"
        }
      ]
    }
  ],
  "indexes": {
    "by_status": { "todo": 7, "in_progress": 1, "todo": 9 },
    "by_kind": { "spec": 5, "impl": 10, "qa": 2 },
    "by_phase": { "P01": 5, "P02": 3, "P03": 2, "P04": 2, "P05": 1, "P06": 1, "P07": 1, "P08": 2 }
  }
}
